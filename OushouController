using UnityEngine;

public class OushouController : MonoBehaviour
{
    public GameObject KomaLine;
    public GameObject UpYajirushi;
    public GameObject RightUpYajirushi;
    public GameObject LeftUpYajirushi;
    public GameObject DownYajirushi;
    public GameObject RightDownYajirushi;
    public GameObject LeftDownYajirushi;
    public GameObject RightYajirushi;
    public GameObject LeftYajirushi;
    
    private Rigidbody2D rb;
    private GameObject currentKomaLine;
    private GameObject currentUpYajirushi;
    private GameObject currentRightUpYajirushi;
    private GameObject currentLeftUpYajirushi;
    private GameObject currentDownYajirushi;
    private GameObject currentRightDownYajirushi;
    private GameObject currentLeftDownYajirushi;
    private GameObject currentRightYajirushi;
    private GameObject currentLeftYajirushi;
    
    bool wolkFlag = true;
    float x,y,z;
    float mA = 1.0f; //as MoveAmount


    void Start()
    {
        rb = this.GetComponent<Rigidbody2D>();
    }

    void Update()
    {
        
            if (Input.GetKeyDown(KeyCode.Q))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(-1*mA, mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.W))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(0, mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.E))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(mA, mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.A))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(-1*mA, 0, 0);
                }
            }
            if (Input.GetKey(KeyCode.A))
            {
                if(wolkFlag == true)
                {
                    transform.Translate(-0.01f,0,0);
                }
            }
            if (Input.GetKeyDown(KeyCode.D))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(mA, 0, 0);
                }
            }
            if (Input.GetKey(KeyCode.D))
            {
                if(wolkFlag == true)
                {
                    transform.Translate(0.01f,0,0);
                }
            }
            if (Input.GetKeyDown(KeyCode.Z))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(-1*mA, -1*mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.X))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(0, -1*mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.C))
            {
                if(wolkFlag == false)
                {
                    wolkFlag = !wolkFlag;
                    this.ClosePanel();
                    transform.Translate(mA, -1*mA, 0);
                }
            }
            if (Input.GetKeyDown(KeyCode.Space))
            {
                this.KeyManager();
            }
        
    }

    public void KeyManager()
    {
        //フラグの反転
        wolkFlag = !wolkFlag;
        //座標の確認
        Vector3 myPosition = transform.position;
        x = transform.position.x;
        y = transform.position.y;
        z = transform.position.z;
        Debug.Log("Space");
        if(wolkFlag == false)
        {
            this.OpenPanel();
        }
        else if(wolkFlag == true)
        {
            this.ClosePanel();
        }
    }
    public void OpenPanel()
    {
        //動きを止める
        rb.bodyType = RigidbodyType2D.Kinematic;
        rb.linearVelocity = Vector2.zero;
        rb.angularVelocity = 0f;
        //特殊パネルの出現
        currentKomaLine = Instantiate(KomaLine);
        currentKomaLine.transform.position = new Vector3(x,y,z);
        //矢印の出現
        currentUpYajirushi = Instantiate(UpYajirushi);
        currentUpYajirushi.transform.position = new Vector3(x,y+1f,z);

        currentRightUpYajirushi = Instantiate(RightUpYajirushi);
        currentRightUpYajirushi.transform.position = new Vector3(x+0.9f,y+0.9f,z);

        currentLeftUpYajirushi = Instantiate(LeftUpYajirushi);
        currentLeftUpYajirushi.transform.position = new Vector3(x-0.9f,y+0.9f,z);

        currentDownYajirushi = Instantiate(DownYajirushi);
        currentDownYajirushi.transform.position = new Vector3(x,y-1f,z);

        currentRightDownYajirushi = Instantiate(RightDownYajirushi);
        currentRightDownYajirushi.transform.position = new Vector3(x+0.9f,y-0.9f,z);

        currentLeftDownYajirushi = Instantiate(LeftDownYajirushi);
        currentLeftDownYajirushi.transform.position = new Vector3(x-0.9f,y-0.9f,z);

        currentRightYajirushi = Instantiate(RightYajirushi);
        currentRightYajirushi.transform.position = new Vector3(x+1f,y,z);

        currentLeftYajirushi = Instantiate(LeftYajirushi);
        currentLeftYajirushi.transform.position = new Vector3(x-1f,y,z);
    }

    public void ClosePanel()
    {
        //動きの再開
        rb.bodyType = RigidbodyType2D.Dynamic;
        //ここにKomaLineを削除する処理を挿入
        if (currentKomaLine != null)
        {
            Destroy(currentKomaLine);
            currentKomaLine = null; // 削除後、参照をクリアしておく
        }

        if(currentUpYajirushi != null)
        {
            Destroy(currentUpYajirushi);
            currentUpYajirushi = null;
        }

        if(currentRightUpYajirushi != null)
        {
            Destroy(currentRightUpYajirushi);
            currentRightUpYajirushi = null;
        }

        if(currentLeftUpYajirushi != null)
        {
            Destroy(currentLeftUpYajirushi);
            currentLeftUpYajirushi = null;
        }

        if(currentDownYajirushi != null)
        {
            Destroy(currentDownYajirushi);
            currentDownYajirushi = null;
        }

        if(currentRightDownYajirushi != null)
        {
            Destroy(currentRightDownYajirushi);
            currentRightDownYajirushi = null;
        }

        if(currentLeftDownYajirushi != null)
        {
            Destroy(currentLeftDownYajirushi);
            currentLeftDownYajirushi = null;
        }

        if(currentRightYajirushi != null)
        {
            Destroy(currentRightYajirushi);
            currentRightYajirushi = null;
        }

        if(currentLeftYajirushi != null)
        {
            Destroy(currentLeftYajirushi);
            currentLeftYajirushi = null;
        }
    }
}
